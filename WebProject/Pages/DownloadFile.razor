@page "/download-file"
@rendermode RenderMode.InteractiveWebAssembly
@using WebProject.Utilities
@inject HttpRequestService httpService
@inject IJSRuntime JS

<script src="downloadFile.js"></script>

<input type="text" @bind="fileId"><br>

<button @onclick="Download">Скачать файл</button><br>
@code {
	UserToken? userToken { get; set; }
	string fileId { get; set; } = string.Empty;

	protected override async Task OnAfterRenderAsync(bool firstRender)
	{
		if (firstRender)
		{
			userToken = await httpService.GetOrCreateTokenAsync();
			//проверка на null
		}
	}
	private async Task Download()
	{
		if (string.IsNullOrWhiteSpace(fileId)) return;
		var response = await httpService.DownloadFileAsync(fileId);

		if (response.IsSuccessStatusCode)
		{
			var fileName = response.Content.Headers.ContentDisposition?.FileName.Trim('\"');

			using var streamRef = new DotNetStreamReference(stream: await response.Content.ReadAsStreamAsync());

			await JS.InvokeVoidAsync("downloadFileFromStream", fileName, streamRef);
		}
	}
}
